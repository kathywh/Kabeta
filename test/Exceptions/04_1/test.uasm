.include ../../../tools/kabeta.uasm

||====================================================================================||
||                                    Data Segment                                    ||
||====================================================================================||
LOCATE(0)

| Stack
stack:
	STORAGE(256)

||====================================================================================||
||                                 Exception  Vectors                                 ||
||====================================================================================||
EXCVT()

rst_vec:
	BR(start)
svc_vec:
	BR(.)
ill_vec:
	BR(.)
inv_op_vec:
	BR(.)
inv_da_vec:
	BR(.)
inv_ia_vec:
	BR(.)
irq_vec:
	BR(.)
urq_vec:
	BR(.)

||====================================================================================||
||                                    Code Segment                                    ||
||====================================================================================||
LOCATE(0x100)

start:

	| Set SP
	MOVC(stack, SP)

	| Switch to User Mode
	MOVC(user_mode%PC_MASK, R0)
	JMP(R0)
user_mode:
	NOP()
	NOP()
	LD(0xA0, R0)
	betaopc(0x3F,0,1,31)		| OPC class, invalid op-code, R0 <op> 1 -> R31
	MOVC(0xA1, R1)
	MOVC(0xA2, R2)
	MOVC(0xA3, R3)
	BR(.)

||====================================================================================||
||                                  Literal  Segment                                  ||
||====================================================================================||

|--------------------------------------|
| Program Signature                    |
|--------------------------------------|
LOCATE(0x0FFC)
__signature:
	LONG(0xCA3EBE3A)